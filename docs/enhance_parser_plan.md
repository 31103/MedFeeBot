# 計画: パーサー機能拡張 (hospital.or.jp 対応)

## 1. 背景

監視対象URLが `https://www.mhlw.go.jp/...` から
`https://www.hospital.or.jp/site/ministry/` に変更されました。
新しいサイトでは、PDFリンクに加えて、関連する文書の日付と名称も取得したいという要望があります。これは特定のサイト構造に対するアドホックな対応となります。

## 2. 目標

`src/parser.py` を修正し、`https://www.hospital.or.jp/site/ministry/`
のHTML構造から以下の情報を抽出できるようにします。

- 文書の公開日 (例: "2025.04.16")
- 文書の名称 (例: "【事務連絡】...")
- PDFファイルの絶対URL

## 3. 修正方針

1. **`src/parser.py` の修正:**
   - 現在の `extract_pdf_links` 関数を修正、または新しい関数 (例:
     `extract_document_info`) を作成します。
   - Beautiful Soup を使用して、指定されたHTML構造
     (`<div class="col-12 isotope-item">` など) を解析します。
   - 各文書エントリから日付、名称、PDFリンク (相対パス) を抽出します。
   - 相対パスを絶対URLに変換します。
   - 抽出した情報を辞書のリストとして返すようにします (例:
     `[{'date': '...', 'title': '...', 'url': '...'}]`)。
2. **`src/main.py` の修正:**
   - `src/parser.py` から返される新しいデータ構造 (辞書のリスト)
     を受け取れるように修正します。
   - 新規文書の判定ロジックは、当面URLのみで行います。
   - Slack通知メッセージ (`src/notifier.py` 経由)
     に、日付と文書名を含めるように修正します。
3. **`src/notifier.py` の修正:**
   - 通知メッセージを生成する関数が、日付とタイトルを含むデータを受け取り、整形されたメッセージを作成できるように修正します。
4. **`src/storage.py` の修正:**
   - 既知の文書リストはURLのみを保存し続けるため、大きな変更は不要とします。新しいデータ構造を受け取る部分でURLのみを抽出するように調整が必要になる可能性があります。
5. **テストの修正・追加:**
   - `tests/test_parser.py`
     を修正し、新しい抽出ロジックと返り値の形式をテストします。
   - `tests/test_notifier.py` を修正し、新しい通知メッセージ形式をテストします。
   - `tests/test_integration.py`
     を修正し、全体の流れが新しいデータ構造で正しく動作するか確認します。

## 4. 作業ブランチ

- `feature/enhance-parser-for-hospital-site`

## 5. 注意点

- この修正は `https://www.hospital.or.jp/site/ministry/`
  の現在のHTML構造に依存するアドホックな対応です。サイト構造が変更された場合、パーサーの再修正が必要になります。
- 既存の厚生労働省サイト用のパーサーロジックは、当面不要になりますが、将来的に再度必要になる可能性も考慮し、コメントアウトまたは別関数として残すことを検討します。
