# **アクティブコンテキスト: MedFeeBot (準備フェーズ完了)**

## **1. 現在のフォーカス**

- **基本実装フェーズへの移行:** `docs/development_plan.md` に基づき、「2.
  基本実装フェーズ」のタスクに着手する。
- **コア機能の実装:**
  設定管理、ロギング、HTTPクライアント、HTMLパーサー、URL管理、Slack通知機能の実装を開始する。

## **2. 最近の変更 (準備フェーズ完了)**

- **開発環境セットアップ完了:**
  - Python 仮想環境 (`.venv`) を作成。
  - `.gitignore` ファイルを作成。
  - 依存関係ファイル (`requirements.txt`, `requirements-dev.txt`)
    を作成し、ライブラリをインストール。
  - Git リポジトリを初期化し、リモート (`origin`) を設定
    (`https://github.com/31103/MedFeeBot`)。
- **プロジェクト管理体制構築:**
  - 開発規約 (`CONTRIBUTING.md`) を作成。
- **技術検証 (PoC) 完了:**
  - HTML取得・PDFリンク抽出スクリプト (`poc/fetch_and_parse.py`) を作成・検証。
  - Slack通知スクリプト (`poc/send_slack_notification.py`) を作成・検証
    (必要なトークン設定、チャンネル招待含む)。
  - `.env` ファイルを作成し、Slack 関連の認証情報を設定。

## **3. 次のステップ (開発計画フェーズ2: 基本実装)**

1. **ユーティリティモジュール実装:**
   - 設定管理機能 (`config.py` など): 環境変数や `.env`
     ファイルから設定を読み込む機能。
   - ロギング機能 (`logger.py` など): 標準出力やファイルへのログ出力設定。
2. **コア機能実装:**
   - HTTPクライアント (`fetcher.py` など): 指定 URL から HTML を取得する機能
     (PoC を基に改善)。
   - HTMLパーサー (`parser.py` など): HTML から PDF リンクを抽出する機能 (PoC
     を基に改善)。
   - URL管理 (`storage.py` など): 検知済み URL リストを管理する機能
     (初期はメモリ上、またはシンプルなファイル I/O)。
   - Slack通知機能 (`notifier.py` など):
     指定チャンネルにメッセージを送信する機能 (PoC を基に改善)。
3. **ローカル実行機能実装:**
   - エントリーポイント (`main.py` など):
     上記モジュールを組み合わせてローカルで実行するスクリプト。
   - モックデータ/テスト用設定の検討。

## **4. アクティブな決定事項**

- 準備フェーズのタスクはすべて完了した。
- 技術検証により、主要技術 (HTML取得、PDFリンク抽出、Slack通知)
  の実現可能性を確認した。
- 次フェーズとして基本実装に進む。
- (変更なし) メモリバンクのコアファイル構造を採用。
- (変更なし) `docs/development_plan.md`
  に記載されたフェーズに従って開発を進める。
- (変更なし) `docs/specifications.md`
  に記載された技術スタック、アーキテクチャ、開発プラクティスを採用する。

## **5. 重要なパターンと設定**

- **開発プロセス:** GitHub Flow, Conventional Commits, SemVer を遵守する。
- **コード品質:** 型アノテーション (`typing`, `mypy`) とテスト (`pytest`,
  目標カバレッジ 80%) を重視する。
- **設定管理:** 環境変数と Secret Manager を適切に使い分ける。ローカル開発では
  `.env` を使用する。
- **エラーハンドリング:**
  仕様書に基づき、特にGCSアクセスエラーのハンドリングを区別する。

## **6. 学びと洞察**

- Slack API トークンには種類があり、用途に応じた適切なトークン (`xoxb-...` for
  `chat.postMessage`) とスコープ (`chat:write`) が必要。
- Slack
  ボットは、メッセージを送信する前にターゲットチャンネルに招待されている必要がある。
- PoC により、基本的な技術要素の組み合わせは可能であることが確認できた。
- (変更なし)
  プロジェクトは詳細な仕様書と開発計画に基づいており、明確なロードマップが存在する。
- (変更なし)
  メモリバンクは、プロジェクトの進行に合わせて継続的に更新する必要がある。
